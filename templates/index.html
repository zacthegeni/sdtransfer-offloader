{% extends "base.html" %}
{% block title %}Dashboard - SDTransfer Offloader{% endblock %}
{% block content %}
  <h2>Dashboard</h2>

  <!-- STATUS BAR -->
  <div class="status-bar">
    <div class="status-item">
      <h4>Free Space</h4>
      <p id="status">{{ space }}</p>
    </div>
    <div class="status-item">
      <h4>CPU Usage</h4>
      <p><i class="fa fa-microchip"></i> {{ cpu }}%</p>
    </div>
    <div class="status-item">
      <h4>Memory Usage</h4>
      <p><i class="fa fa-memory"></i> {{ mem }}%</p>
    </div>
  </div>

  <!-- MAIN CONTROLS PANEL -->
  <div class="panel">
    <h3>Main Controls</h3>
    <div class="button-group">
      <!-- Big Upload Button -->
      <div class="upload-section">
        <button class="upload-btn" onclick="location.href='/run/upload'">
          <i class="fa fa-cloud-upload-alt"></i> Upload to Google Drive
        </button>
        <p class="help-text">
          Click this button to upload files from your SD card to your Google Drive.
          Make sure your rclone remote (named "gdrive") is properly configured.
        </p>
      </div>
      <!-- Other Buttons -->
      <button class="btn" onclick="location.href='/run/offload'">
        <i class="fa fa-download"></i> Offload
      </button>
      <button class="btn" onclick="location.href='/run/retry'">
        <i class="fa fa-redo"></i> Retry
      </button>
      <button class="btn" onclick="location.href='/run/eject'">
        <i class="fa fa-eject"></i> Eject SD Card
      </button>
      <button class="btn" onclick="location.href='/run/reboot'">
        <i class="fa fa-sync-alt"></i> Reboot Pi
      </button>
      <button class="btn" onclick="location.href='/run/shutdown'">
        <i class="fa fa-power-off"></i> Shutdown Pi
      </button>
    </div>
  </div>

  <!-- SETTINGS & HELP SECTION -->
  <div class="panel">
    <h3>Settings &amp; Help</h3>
    <p>
      <strong>Upload Settings:</strong> Adjust upload parameters (e.g. file retention, upload frequency)
      by editing the configuration files or via the upcoming settings interface.
    </p>
    <p>
      <strong>Help:</strong> For assistance configuring rclone and email notifications, please visit
      the <a href="https://rclone.org/docs/" target="_blank">rclone documentation</a> or check our online help.
    </p>
  </div>

  <script>
    function pollStatus() {
      fetch('/status', {credentials: 'include'})
        .then(response => response.json())
        .then(data => {
          document.getElementById('status').innerText = data.free_space;
        });
    }
    setInterval(pollStatus, 10000);
    window.onload = pollStatus;
  </script>
{% endblock %}
